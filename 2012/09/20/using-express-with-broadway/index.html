<!DOCTYPE html><html lang="en"><head><title>using express with broadway</title><meta name="keywords" content="javascript,node.js,broadway,express"><meta name="author" content="Brad Harris"><meta name="robots" content="index,follow"><meta name="viewport" content="width=device-width,initial-scale=0.5"><link href="/css/blog.css" rel="stylesheet"><link rel="alternate" type="application/rss+xml" title="selfcontained Â» rss" href="http://www.selfcontained.us/feed/rss.xml"></head><body><div id="main"><header><h1><a href="/">selfcontained</a><small>[web development]</small></h1></header><div id="content-container"><aside class="sidebar"><div class="about"><img src="/images/bradharris.gif" width="100" height="100" align="left"><p>	My name is Brad Harris and I'm an engineer @ Yahoo!
	I love architecting software and developing simple and elegant solutions to complex problems. I
	've worked for companies on large enterprise projects, as well as smaller projects, and find satisfaction across the board.
	I enjoy learning and applying new principles and patterns to my work.
</p></div><div class="recent-articles"><h3>recent articles</h3><ul><li><a href="/2015/02/10/hapiDay-oakland-2014">hapiDay Oakland 2014 - The Middle-Tier with hapi</a><div class="date">Tuesday February 10, 2015</div></li><li><a href="/2014/01/14/modern-componentized-ui">talk on modern componentized ui</a><div class="date">Tuesday January 14, 2014</div></li><li><a href="/2013/09/14/flipflop-0.1.0-configurable-urls">flipflop 0.1.0 - configurable urls</a><div class="date">Saturday September 14, 2013</div></li><li><a href="/2012/09/20/using-express-with-broadway">using express with broadway</a><div class="date">Thursday September 20, 2012</div></li><li><a href="/2012/09/18/decoupling-your-node-js-application-with-broadway">decoupling your node.js application with broadway</a><div class="date">Tuesday September 18, 2012</div></li><li><a href="/2012/09/01/hello-fabric">hello fabric</a><div class="date">Saturday September 1, 2012</div></li><li><a href="/2012/05/08/node-js-circular-dependencies">node.js and circular dependencies</a><div class="date">Tuesday May 8, 2012</div></li><li><a href="/2012/04/27/backup-iphoto-with-google-drive">google.drive.backup(iphoto.library)</a><div class="date">Friday April 27, 2012</div></li><li><a href="/2012/04/14/makdown-powered-blogs">markdown powered blogs</a><div class="date">Saturday April 14, 2012</div></li><li><a href="/2012/04/04/node-js-clusters">node.js clusters</a><div class="date">Wednesday April 4, 2012</div></li><li><a href="/2011/07/08/markdown-me">markdown.me</a><div class="date">Friday July 8, 2011</div></li><li><a href="/2011/05/28/phpunit-mocks-and-closures">PHPUnit, Mocks and Closures</a><div class="date">Saturday May 28, 2011</div></li><li><a href="/2011/04/20/php-and-an-abstract-singleton">PHP and an abstract Singleton</a><div class="date">Wednesday April 20, 2011</div></li><li><a href="/2011/04/20/review-yahoo-user-interface-library-2-x-cookbook">Review: Yahoo! User Interface Library 2.x Cookbook</a><div class="date">Wednesday April 20, 2011</div></li><li><a href="/2011/02/28/awaiting-yahoo-user-interface-library-2-x-cookbook">Awaiting Yahoo! User Interface Library 2.x Cookbook</a><div class="date">Monday February 28, 2011</div></li><li><a href="/2011/01/23/latest-endeavor-whoopdwhoop-com">Latest Endeavor: whoopdwhoop.com</a><div class="date">Sunday January 23, 2011</div></li><li><a href="/2010/11/30/php-coalesce">?: PHP Coalesce</a><div class="date">Tuesday November 30, 2010</div></li><li><a href="/2010/11/19/yui-jquery">YUI =&gt; jQuery?</a><div class="date">Friday November 19, 2010</div></li><li><a href="/2010/10/22/yahoo-new-adventure">Yahoo!  A New Adventure</a><div class="date">Friday October 22, 2010</div></li><li><a href="/2010/09/04/yui-2-8-learning-the-library-book-review">YUI 2.8 Learning the Library book review</a><div class="date">Saturday September 4, 2010</div></li><li><a href="/2010/08/13/yui-2-8-learning-the-library-free-chapter">&quot;YUI 2.8: Learning the Library&quot; Free Chapter</a><div class="date">Friday August 13, 2010</div></li><li><a href="/2010/05/08/first-iphone-app-lds-gems">First iPhone App - LDS Gems</a><div class="date">Saturday May 8, 2010</div></li><li><a href="/2010/03/30/doctrine-model-hydration">Doctrine Model Hydration</a><div class="date">Tuesday March 30, 2010</div></li><li><a href="/2009/09/16/getting-keycode-values-in-javascript">Getting keycode values in Javascript</a><div class="date">Wednesday September 16, 2009</div></li><li><a href="/2009/01/23/scoping-javascript-closures-in-loops">Scoping Javascript closures in loops</a><div class="date">Friday January 23, 2009</div></li></ul></div><div class="links"><h3>links</h3><ul><li><a href="/archive">archive</a></li><li><a href="/feed/rss.xml">feed</a></li></ul></div><div class="YAD-7eb3e811-64f1-37bf-bb50-7a9b67a70521"><script>(function(a,b,c,d,e,f){a[d]||(a[d]=
 function(){(a[d].q=a[d].q||[]).push([arguments,+new Date])});
 e=b.createElement(c);f=b.getElementsByTagName(c)[0];
 e.src='https://s.yimg.com/uq/syndication/yad.js';e.async=true;
 f.parentNode.insertBefore(e,f)}(window,document,'script','yad'));
 yad('7eb3e811-64f1-37bf-bb50-7a9b67a70521');

</script></div></aside><section id="content"><article><h2><a href="/2012/09/20/using-express-with-broadway">using express with broadway</a></h2><div class="meta"><ul class="tags"><li><a href="/tag/javascript">javascript</a></li><li><a href="/tag/node.js">node.js</a></li><li><a href="/tag/broadway">broadway</a></li><li><a href="/tag/express">express</a></li></ul><img src="http://www.gravatar.com/avatar/c20763ec853bb1d2eb3e8a08cc5a28b9?s=30.jpg" width="30" height="30"><div class="date">Thursday September 20, 2012</div><div class="name">By Brad Harris</div></div><div class="content"><p><a href="http://expressjs.com/">Express</a> is by no doubt an extremely popular http application server/framework for node.js.  In this article I&#39;d like to demonstrate how you can take advantage of <a href="https://github.com/flatiron/broadway">broadway</a> and <a href="http://expressjs.com/">express</a> together.

</p>
<p>In this approach, we&#39;ll treat the <em>http server</em> that <code>express</code> provides as just another plugin to our <code>broadway</code> application.

</p>
<h2>express http plugin</h2>
<p>First we&#39;ll create an http plugin encapsulating express.

</p>
<pre><code class="lang-javascript"><span class="comment">// http.js</span>

<span class="keyword">var</span> express = <span class="keyword">require</span>(<span class="string">'express'</span>);

<span class="keyword">var</span> HttpPlugin = exports;

HttpPlugin.name = <span class="string">'http'</span>;

HttpPlugin.attach = <span class="keyword">function</span>(options) {
    <span class="keyword">var</span> app = <span class="keyword">this</span>;

    <span class="keyword">var</span> server = app.http = express();
    server.<span class="keyword">use</span>(server.router);

    <span class="keyword">require</span>(<span class="string">'./routes'</span>)(app);
};

HttpPlugin.init = <span class="keyword">function</span>(done) {
    done();
};</code></pre>
<p>I&#39;d also suggest defining your routes in their own module(s), and passing along the broadway application.  This will allow them to take full advantage of any other functionality your application acquires through other plugins.

</p>
<pre><code class="lang-javascript"><span class="comment">// routes.js</span>
module.exports = <span class="keyword">function</span>(app) {

    app.http.get(<span class="string">'/'</span>, <span class="keyword">function</span>(req, res){
        res.send(<span class="string">'express on broadway'</span>);
    });

};</code></pre>
<h2>broadway.concat(express)</h2>
<p>Next we&#39;ll create a broadway application and toss in our http plugin.

</p>
<pre><code class="lang-javascript"><span class="comment">// app.js</span>

<span class="keyword">var</span> broadway = <span class="keyword">require</span>(<span class="string">'broadway'</span>),
    app = <span class="keyword">new</span> broadway.App();

app.<span class="keyword">use</span>(<span class="keyword">require</span>(<span class="string">'./http'</span>));

app.init(<span class="keyword">function</span>(err) {
    app.http.listen(<span class="number">8080</span>);
});</code></pre>
<p>You can also just <code>module.exports = app.http</code> if you&#39;re using something like <code>up</code> and need to export an http server from your main applicaiton.

</p>
<h2>krakens.release()</h2>
<p>Finally, fire up your application

</p>
<pre><code>&gt;node app.js</code></pre>
<p>That&#39;s all there is to it.  In this example, the http server is just one piece of our application, and we can bolt on additional functionality as needed through more plugins.


</p>

</div><div class="comments"><div id="disqus_thread"></div><script type='text/javascript'>disqus_identifier='/2012/09/20/using-express-with-broadway';disqus_url='http://selfcontained.us/2012/09/20/using-express-with-broadway';</script><script type="text/javascript">var disqus_shortname = 'selfcontained';
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();

</script><noscript>	Please enable JavaScript to view the
<a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href="http://disqus.com" class="dsq-brlink">blog comments powered by<span class="logo-disqus">Disqus</span></a></div></article></section></div><footer>	&copy; 2012 Brad Harris |
	powered by
<a href="https://github.com/selfcontained/flipflop">flipflop</a></footer></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-254292-12']);
_gaq.push(['_trackPageview']);

(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script><div class="YAD-9a9f8d42-22f8-31d6-b8c4-54958e4eeba4"></div><script>(function(a,b,c,d,e,f){a[d]||(a[d]=
 function(){(a[d].q=a[d].q||[]).push([arguments,+new Date])});
 e=b.createElement(c);f=b.getElementsByTagName(c)[0];
 e.src='https://s.yimg.com/uq/syndication/yad.js';e.async=true;
 f.parentNode.insertBefore(e,f)}(window,document,'script','yad'));
 yad('9a9f8d42-22f8-31d6-b8c4-54958e4eeba4');

</script></body></html>