<!DOCTYPE html><html lang="en"><head><title>testing - selfcontained</title><meta name="keywords" content="software,web development,brad harris"><meta name="author" content="Brad Harris"><meta name="robots" content="index,follow"><meta name="viewport" content="width=device-width,initial-scale=0.5"><link href="/css/blog.css" rel="stylesheet"><link rel="alternate" type="application/rss+xml" title="selfcontained Â» rss" href="http://www.selfcontained.us/feed/rss.xml"></head><body><div id="main"><header><h1><a href="/">selfcontained</a><small>[web development]</small></h1></header><div id="content-container"><aside class="sidebar"><div class="about"><img src="/images/bradharris.gif" width="100" height="100" align="left"><p>	My name is Brad Harris and I'm an engineer @ Yahoo!
	I love architecting software and developing simple and elegant solutions to complex problems. I
	've worked for companies on large enterprise projects, as well as smaller projects, and find satisfaction across the board.
	I enjoy learning and applying new principles and patterns to my work.
</p></div><div class="recent-articles"><h3>recent articles</h3><ul><li><a href="/2014/01/14/modern-componentized-ui">talk on modern componentized ui</a><div class="date">Tuesday January 14, 2014</div></li><li><a href="/2013/09/14/flipflop-0.1.0-configurable-urls">flipflop 0.1.0 - configurable urls</a><div class="date">Saturday September 14, 2013</div></li><li><a href="/2012/09/20/using-express-with-broadway">using express with broadway</a><div class="date">Thursday September 20, 2012</div></li><li><a href="/2012/09/18/decoupling-your-node-js-application-with-broadway">decoupling your node.js application with broadway</a><div class="date">Tuesday September 18, 2012</div></li><li><a href="/2012/09/01/hello-fabric">hello fabric</a><div class="date">Saturday September 1, 2012</div></li><li><a href="/2012/05/08/node-js-circular-dependencies">node.js and circular dependencies</a><div class="date">Tuesday May 8, 2012</div></li><li><a href="/2012/04/27/backup-iphoto-with-google-drive">google.drive.backup(iphoto.library)</a><div class="date">Friday April 27, 2012</div></li><li><a href="/2012/04/14/makdown-powered-blogs">markdown powered blogs</a><div class="date">Saturday April 14, 2012</div></li><li><a href="/2012/04/04/node-js-clusters">node.js clusters</a><div class="date">Wednesday April 4, 2012</div></li><li><a href="/2011/07/08/markdown-me">markdown.me</a><div class="date">Friday July 8, 2011</div></li><li><a href="/2011/05/28/phpunit-mocks-and-closures">PHPUnit, Mocks and Closures</a><div class="date">Saturday May 28, 2011</div></li><li><a href="/2011/04/20/php-and-an-abstract-singleton">PHP and an abstract Singleton</a><div class="date">Wednesday April 20, 2011</div></li><li><a href="/2011/04/20/review-yahoo-user-interface-library-2-x-cookbook">Review: Yahoo! User Interface Library 2.x Cookbook</a><div class="date">Wednesday April 20, 2011</div></li><li><a href="/2011/02/28/awaiting-yahoo-user-interface-library-2-x-cookbook">Awaiting Yahoo! User Interface Library 2.x Cookbook</a><div class="date">Monday February 28, 2011</div></li><li><a href="/2011/01/23/latest-endeavor-whoopdwhoop-com">Latest Endeavor: whoopdwhoop.com</a><div class="date">Sunday January 23, 2011</div></li><li><a href="/2010/11/30/php-coalesce">?: PHP Coalesce</a><div class="date">Tuesday November 30, 2010</div></li><li><a href="/2010/11/19/yui-jquery">YUI =&gt; jQuery?</a><div class="date">Friday November 19, 2010</div></li><li><a href="/2010/10/22/yahoo-new-adventure">Yahoo!  A New Adventure</a><div class="date">Friday October 22, 2010</div></li><li><a href="/2010/09/04/yui-2-8-learning-the-library-book-review">YUI 2.8 Learning the Library book review</a><div class="date">Saturday September 4, 2010</div></li><li><a href="/2010/08/13/yui-2-8-learning-the-library-free-chapter">&quot;YUI 2.8: Learning the Library&quot; Free Chapter</a><div class="date">Friday August 13, 2010</div></li><li><a href="/2010/05/08/first-iphone-app-lds-gems">First iPhone App - LDS Gems</a><div class="date">Saturday May 8, 2010</div></li><li><a href="/2010/03/30/doctrine-model-hydration">Doctrine Model Hydration</a><div class="date">Tuesday March 30, 2010</div></li><li><a href="/2009/09/16/getting-keycode-values-in-javascript">Getting keycode values in Javascript</a><div class="date">Wednesday September 16, 2009</div></li><li><a href="/2009/01/23/scoping-javascript-closures-in-loops">Scoping Javascript closures in loops</a><div class="date">Friday January 23, 2009</div></li><li><a href="/2009/01/23/browser-autocomplete-and-keyup-events">Browser autocomplete and keyup events</a><div class="date">Friday January 23, 2009</div></li></ul></div><div class="links"><h3>links</h3><ul><li><a href="/archive">archive</a></li><li><a href="/feed/rss.xml">feed</a></li></ul></div><div class="YAD-7eb3e811-64f1-37bf-bb50-7a9b67a70521"><script>(function(a,b,c,d,e,f){a[d]||(a[d]=
 function(){(a[d].q=a[d].q||[]).push([arguments,+new Date])});
 e=b.createElement(c);f=b.getElementsByTagName(c)[0];
 e.src='https://s.yimg.com/uq/syndication/yad.js';e.async=true;
 f.parentNode.insertBefore(e,f)}(window,document,'script','yad'));
 yad('7eb3e811-64f1-37bf-bb50-7a9b67a70521');

</script></div></aside><section id="content"><h2>Articles tagged with <i>"testing"</i> (1)</h2><article><h2><a href="/2011/05/28/phpunit-mocks-and-closures">PHPUnit, Mocks and Closures</a></h2><div class="meta"><ul class="tags"><li><a href="/tag/php">php</a></li><li><a href="/tag/testing">testing</a></li></ul><img src="http://www.gravatar.com/avatar/c20763ec853bb1d2eb3e8a08cc5a28b9?s=30.jpg" width="30" height="30"><div class="date">Saturday May 28, 2011</div><div class="name">By Brad Harris</div></div><div class="content"><p>I like <a href="http://www.phpunit.de/manual/3.6/en/index.html">PHPUnit</a>, and I like <a href="http://us3.php.net/manual/en/functions.anonymous.php">closures</a>, but haven&#39;t found many useful cases for them (closures) in PHP yet.  Just recently I came across a situation where I needed a closure when working with PHPUnit Mock objects.  For those not familiar with Mock Objects in regards to testing, <a href="http://www.phpunit.de/manual/3.6/en/test-doubles.html#test-doubles.mock-objects">here&#39;s a link</a>.  It&#39;s fairly common when creating a mock object for testing to specify what a function is expected to be called with, and what it will return in that case.  Below I&#39;m creating a mock &#39;User&#39; object that will return 18 for the age however many times it is called.
</p>
<pre><code class="lang-php"><span class="keyword">class</span> UserTest <span class="keyword">extends</span> PHPUnit_Framework_TestCase{

    <span class="keyword">public</span> <span class="keyword">function</span> testGetAge() {
        <span class="variable">$user</span> = <span class="variable">$this</span>->getMock(<span class="string">'User'</span>, <span class="keyword">array</span>(<span class="string">'getAge'</span>))
            ->expects(<span class="variable">$this</span>->any())
            ->method(<span class="string">'getAge'</span>)
            ->will(<span class="variable">$this</span>->returnValue(<span class="number">18</span>));
        <span class="variable">$this</span>->assertTrue(<span class="variable">$user</span>->getAge(), <span class="number">18</span>);
    }

}</code></pre>
<p>This is a pretty straight forward example of Mocks, but what happens when the value you want to return is dependent on the value it is called with, and there is some logic required to process this?  This is where closures come in handy.  Let&#39;s say you have a dynamic array you&#39;ve built up, and you want to return true if a particular function, <strong>hasValue</strong> is called with a value that exists in that array.  Here&#39;s how you can do it with <strong>Mocks</strong> and <strong>closures</strong>, using the <strong>returnCallback</strong> functionality of PHPUnit:
</p>
<pre><code class="lang-php"><span class="keyword">class</span> UserTest <span class="keyword">extends</span> PHPUnit_Framework_TestCase{

    <span class="keyword">public</span> <span class="keyword">function</span> testInArray() {
        <span class="variable">$values</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">10</span>,<span class="number">78</span>,<span class="number">30</span>);
        <span class="variable">$user</span> = <span class="variable">$this</span>->getMock(<span class="string">'User'</span>, <span class="keyword">array</span>(<span class="string">'hasValue'</span>))
            ->expects(<span class="variable">$this</span>->any())
            ->method(<span class="string">'hasValue'</span>)
            ->with(<span class="variable">$this</span>->anything())
            ->will(<span class="variable">$this</span>->returnCallback(<span class="keyword">function</span>(<span class="variable">$value</span>) <span class="keyword">use</span> (<span class="variable">$values</span>){
                <span class="keyword">return</span> in_array(<span class="variable">$value</span>, <span class="variable">$values</span>);
            }));
        <span class="variable">$this</span>->assertTrue(<span class="variable">$user</span>->hasValue(<span class="number">10</span>));
        <span class="variable">$this</span>->assertTrue(<span class="variable">$user</span>->hasValue(<span class="number">99</span>) == <span class="keyword">false</span>);
    }

}</code></pre>
<p>When I call <strong>hasValue</strong>, passing in 10, we&#39;ll get true, and with 99 it&#39;s false.  This is checked at runtime when the closure is executed, checking against the <strong>$values</strong> array.  Also, stay away from <a href="http://canvasrider.com/tracks/featured">Canvas Rider</a>, it&#39;s dangerously addictive.

</p>

</div></article></section></div><footer>	&copy; 2012 Brad Harris |
	powered by
<a href="https://github.com/selfcontained/flipflop">flipflop</a></footer></div><script type="text/javascript">var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-254292-12']);
_gaq.push(['_trackPageview']);

(function() {
 var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
 ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

</script><div class="YAD-9a9f8d42-22f8-31d6-b8c4-54958e4eeba4"></div><script>(function(a,b,c,d,e,f){a[d]||(a[d]=
 function(){(a[d].q=a[d].q||[]).push([arguments,+new Date])});
 e=b.createElement(c);f=b.getElementsByTagName(c)[0];
 e.src='https://s.yimg.com/uq/syndication/yad.js';e.async=true;
 f.parentNode.insertBefore(e,f)}(window,document,'script','yad'));
 yad('9a9f8d42-22f8-31d6-b8c4-54958e4eeba4');

</script></body></html>